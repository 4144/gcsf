\chapter{Performance evaluation}

Although comparing GCSF with similar tools is a fuzzy task, I will attempt to construct an appropriate performance analysis. For this purpose I have selected three other projects:

\begin{itemize}
  \item \emph{GDriveFS}, which I personally used prior to starting work on GCSF
  \item \emph{google-drive-ocamlfuse}, which seems to be the most popular choice
  \item \emph{gdrive}, which is no longer maintained
\end{itemize}


Here is a brief comparison between these projects:

\makebox[\textwidth]{
\begin{tabular}{cc|c|c|c|c|l|l}
\cline{3-6}
& & \multicolumn{1}{ c| }{GCSF} & \multicolumn{1}{ c|}{GDriveFS} & \multicolumn{1}{ c| }{google-drive-ocamlfuse} & \multicolumn{1}{ c| }{gdrive} \\ \cline{1-6}

\multicolumn{1}{ |l| }{\multirow{7}{*}{Github Statistics} } &
\multicolumn{1}{  l| }{Owner}        & Sergiu Pușcaș     & Dustin Oprea       & Alessandro Strada & Carbo Kuo       \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{First Commit} & \date{April 2018} & \date{August 2012} & \date{May 2012}   & \date{May 2012} \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{Commits}      & 105               & 395                & 511               & 30              \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{Releases}     & 1                 & 23                 & 71                & 0               \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{Contributors} & 1                 & 6                  & 12                & 1               \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{Stars}        & 0                 & 489                & 2063              & 16              \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{Forks}        & 0                 & 81                 & 151               & 4               \\ \cline{1-6}

\multicolumn{1}{ |l| }{\multirow{2}{*}{Technical Details} } &
\multicolumn{1}{  l| }{Language}     & Rust              & Python 2.7         & OCaml             & C++             \\ \cline{2-6}
\multicolumn{1}{ |l| }{}             &
\multicolumn{1}{  l| }{LoC}          & 1887              & 5232               & 7962              & 1755            \\ \cline{1-6}
\end{tabular}
}

In the next sections I will discuss each individual tool.

\section{GDriveFS}

As of \date{June 2018}, \emph{GDriveFS} aims to be \emph{``an innovative FUSE wrapper for Google Drive''}\cite{gdrivefs}. It has been developed and maintained since \date{August 2012}, accumulating along the way a total of almost 400 commits, 23 releases, 6 contributors and 81 forks. As a consequence, GDriveFS has more features than GCSF and its longevity makes it a time-proven tool, which I can personally attest by my own experience. GDriveFS worked out of the box in most situations where I attempted to use it.

Unfortunately, I encountered some issues with the latest releases. I will walk through a first time setup of this application in order to illustrate its drawbacks. First, we create a new virtual environment using \codeword{virtualenv} in order to avoid conflicts between global Python packages and the local requirements of GDriveFS. We can easily install GDriveFS in this environment as a \codeword{pip} package.

\begin{lstlisting}[caption=Creating a virtual environment and installing GDriveFS]
$ virtualenv2 gdrivefs
New python executable in /home/sergiu/work/gdrivefs/bin/python2
Also creating executable in /home/sergiu/work/gdrivefs/bin/python
Installing setuptools, pip, wheel...done.
$ cd gdrivefs
$ source bin/activate
(gdrivefs) $ pip install gdrivefs
Collecting gdrivefs
Collecting fusepy==2.0.2 (from gdrivefs)
Collecting httplib2==0.8 (from gdrivefs)
[...]
Successfully installed gdrivefs-0.14.9 [...]
\end{lstlisting}

Now we are ready to run into our first problem. The official documentation\cite{gdrivefs} suggests using \codeword{gdfstool auth_automatic} in order to log in with our Google account. However, we encounter an error:

\begin{lstlisting}[caption=GDriveFS nonexistent authentication command]
(gdrivefs) $ gdfstool auth_automatic
usage: gdfstool [-h] {auth,mount} ...
gdfstool: error: argument command: invalid choice: 'auth_automatic' (choose from 'auth', 'mount')
\end{lstlisting}

It seems that there is an inconsistency between the documentation and the application itself. No problem. We can follow the suggestion provided by the error message and execute \codeword{gdfstool auth} instead. We provide the \codeword{-o} flag in order to open the authentication form in a browser window. After logging in and allowing the application to access our Drive account, we are ready to feed the access code into \codeword{gdfstool}:

\begin{lstlisting}[caption=GDriveFS authentication error]
(gdrivefs) $ gdfstool auth -a /tmp/credentials "<authorization_code>"
[...]
gdrivefs.errors.AuthorizationFailureError: Could not do auth-exchange (this was either a legitimate error, or the auth-exchange was attempted when not necessary): [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:726)
\end{lstlisting}

This is strange. After researching the problem, we find a relevant open issue on this subject\cite{gdrivefs_ssl_handshake_error}. According to user \emph{blitz313}, the root cause is one of the dependencies. Manual installation of package \codeword{httplib2-0.10.3} (instead of the required version \codeword{0.8}) seems to solve this problem and we can finally mount the filesystem:

\begin{lstlisting}[caption=GDriveFS filesystem mount]
(gdrivefs) $ gdfstool mount /tmp/credentials /mnt/gdrivefs
(gdrivefs) $ ls /mnt/gdrivefs/
drwxrwxrwx@    - sergiu 11 Jun 18:56 Books
drwxrwxrwx@    - sergiu 11 Jun 19:04 School projects
drwxrwxrwx@    - sergiu 11 Jun 18:59 Stock photo collection
.rw-rw-rw-@ 1.0k sergiu 11 Jun 18:57 Business spreadsheet#
.rw-rw-rw-@ 613k sergiu 11 Jun 19:38 LaTeX Guide.pdf
.rw-rw-rw-@ 1.0k sergiu 12 Jun 15:27 Some document#
.rw-rw-rw-@ 1.0k sergiu 11 Jun 18:57 This presentation#
\end{lstlisting}

\makebox[\textwidth]{
\begin{tabular}{|p{9.0cm}|p{1.2cm}|p{1.8cm}|}
\cline{1-3}
Command & GCSF & GDriveFS \\ \cline{1-3}
Recursively listing all filesystem (empty cache) &  0.6 s  & 34.3 s  \\ \cline{1-3}
Recursively listing all filesystem (cached)      &  0.02 s &  0.14 s \\ \cline{1-3}
Copying a 1 MB file                              &  2.5 s  &  3.4 s  \\ \cline{1-3}
Copying a 100 MB file                            & 51.9 s  & 15.2 s\footnote{Although the execution ends after 15 seconds, the file is still being uploaded in the background and cannot be accessed until the transfer is finished} \\ \cline{1-3}
Reading a 100 MB file (empty cache)              & 31.6 s  & 49.7 s  \\ \cline{1-3}
Reading a 100 MB file (cached)                   &  0.3 s  & 50.3    \\ \cline{1-3}
Deleting a 1 MB file                             &  0.5 s  &  0.6 s  \\ \cline{1-3}
Deleting a 100 MB file                           &  0.7 s  &  0.6 s  \\ \cline{1-3}
Creating a new directory                         &  0.8 s  &  1.1 s  \\ \cline{1-3}
Deleting a directory                             &  0.4 s  &  0.8 s  \\ \cline{1-3}


\end{tabular}
}
